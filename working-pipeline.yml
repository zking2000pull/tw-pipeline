node('master') {
	stage('Workspace Cleanup') {
         deleteDir()
    }
    stage('Git Checkout') {
          checkout([$class: 'GitSCM',
          branches: [[name: '*/master']],
          doGenerateSubmoduleConfigurations: false,
          extensions: [],
          gitTool: 'GIT_linux-1.9.1',
          submoduleCfg: [],
          userRemoteConfigs: [[url: 'https://github.com/zking2000/tw-code2.git']]])
    }
    stage('Code Build') {
          sh 'mvn clean package'
    }
    stage('Code Test') {
          sh 'mvn clean test'
    }
    stage('Static Asset package') {
          sh 'zip -qr static_asset.zip static_asset.html'
    }
    stage('Docker Build') {
          sh 'docker build github.com/zking2000/dockerfile -t zhouhua/webapps:4.0'
    }
    stage('Docker Run') {
          sh 'docker run -d -p 12345:8080 -v /Users/StephenChou/Desktop/Apps/TW/Workspace/webapps:/var/tmp/tomcat/apache-tomcat-7.0.85/webapps --name=webapps zhouhua/webapps:4.0'
    }
    stage('Code Deployment') {
          sh '''cp sample.war /Users/StephenChou/Desktop/Apps/TW/Workspace/webapps
          cp static_asset.zip /Users/StephenChou/Desktop/Apps/TW/Workspace/webapps
          unzip /Users/StephenChou/Desktop/Apps/TW/Workspace/webapps/static_asset.zip
          cp /Users/StephenChou/Desktop/Apps/TW/Workspace/webapps/static_asset.html /Users/StephenChou/Desktop/Apps/TW/Workspace/webapps/sample/index.html'''
    }
}




